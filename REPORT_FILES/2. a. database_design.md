# Database Design - Bank Saving System

## ğŸ¯ Overview

Database untuk Bank Saving System menggunakan **PostgreSQL** (via Supabase) dengan 4 tabel utama yang saling berelasi.

---

## ğŸ“Š Entity Relationship Diagram (ERD)

```
customers (1) â”€â”€â”¬â”€â”€> (N) accounts (N) â”€â”€â”¬â”€â”€> (N) transactions
                â”‚                        â”‚
deposito_types (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Relationships:**
- 1 Customer memiliki banyak Account (1:N)
- 1 Deposito Type digunakan oleh banyak Account (1:N)
- 1 Account memiliki banyak Transaction (1:N)

---

## ğŸ—„ï¸ Table Structures

### 1. customers

**Purpose:** Menyimpan data customer/nasabah bank

| Column | Type | Constraint | Description |
|--------|------|------------|-------------|
| `id` | UUID | PRIMARY KEY | Unique identifier |
| `name` | VARCHAR(255) | NOT NULL | Nama customer |
| `created_at` | TIMESTAMP | DEFAULT NOW() | Tanggal dibuat |
| `updated_at` | TIMESTAMP | DEFAULT NOW() | Tanggal diupdate |

**Indexes:**
- PRIMARY KEY on `id`

**Sample Data:**
```sql
INSERT INTO customers (id, name) VALUES 
('9171310b-c6cf-4261-b40d-fa7f84b33dd6', 'John Doe'),
('8c8e3a40-9b8d-4d7b-9c8a-1234567890ab', 'Jane Smith');
```

---

### 2. deposito_types

**Purpose:** Konfigurasi tipe deposito dan rate bunga tahunan

| Column | Type | Constraint | Description |
|--------|------|------------|-------------|
| `id` | UUID | PRIMARY KEY | Unique identifier |
| `name` | VARCHAR(255) | NOT NULL | Nama deposito type (e.g., "Gold Deposito") |
| `yearly_return` | DECIMAL(5,4) | NOT NULL, CHECK (0-1) | Return tahunan (0.05 = 5%) |
| `created_at` | TIMESTAMP | DEFAULT NOW() | Tanggal dibuat |
| `updated_at` | TIMESTAMP | DEFAULT NOW() | Tanggal diupdate |

**Indexes:**
- PRIMARY KEY on `id`

**Constraints:**
- `yearly_return` must be between 0 and 1

**Sample Data:**
```sql
INSERT INTO deposito_types (id, name, yearly_return) VALUES 
('a1b2c3d4-e5f6-7890-abcd-ef1234567890', 'Gold Deposito', 0.05),
('b2c3d4e5-f6a7-8901-bcde-f12345678901', 'Platinum Deposito', 0.08);
```

---

### 3. accounts

**Purpose:** Akun deposito customer dengan balance

| Column | Type | Constraint | Description |
|--------|------|------------|-------------|
| `id` | UUID | PRIMARY KEY | Unique identifier |
| `customer_id` | UUID | FOREIGN KEY, NOT NULL | Reference ke customers.id |
| `deposito_type_id` | UUID | FOREIGN KEY, NOT NULL | Reference ke deposito_types.id |
| `balance` | DECIMAL(15,2) | DEFAULT 0 | Saldo akun (Rupiah) |
| `created_at` | TIMESTAMP | DEFAULT NOW() | Tanggal account dibuat (penting untuk interest) |
| `updated_at` | TIMESTAMP | DEFAULT NOW() | Tanggal diupdate |

**Indexes:**
- PRIMARY KEY on `id`
- FOREIGN KEY on `customer_id` â†’ `customers(id)` ON DELETE CASCADE
- FOREIGN KEY on `deposito_type_id` â†’ `deposito_types(id)` ON DELETE RESTRICT

**Constraints:**
- Customer hanya bisa punya 1 account (enforced via application logic)
- `balance` harus >= 0

**Sample Data:**
```sql
INSERT INTO accounts (id, customer_id, deposito_type_id, balance) VALUES 
('7a3e9140-5c22-4c9b-9f85-abcdef123456', 
 '9171310b-c6cf-4261-b40d-fa7f84b33dd6', 
 'a1b2c3d4-e5f6-7890-abcd-ef1234567890', 
 1500000.00);
```

---

### 4. transactions

**Purpose:** Riwayat transaksi deposit dan withdrawal

| Column | Type | Constraint | Description |
|--------|------|------------|-------------|
| `id` | UUID | PRIMARY KEY | Unique identifier |
| `account_id` | UUID | FOREIGN KEY, NOT NULL | Reference ke accounts.id |
| `type` | VARCHAR(20) | NOT NULL | 'deposit' atau 'withdrawal' |
| `amount` | DECIMAL(15,2) | NOT NULL | Jumlah transaksi |
| `transaction_date` | TIMESTAMP | NOT NULL | Tanggal transaksi |
| `balance_before` | DECIMAL(15,2) | NOT NULL | Saldo sebelum transaksi |
| `balance_after` | DECIMAL(15,2) | NOT NULL | Saldo setelah transaksi |
| `interest_earned` | DECIMAL(15,2) | NULL | Bunga yang didapat (withdrawal only) |
| `months_held` | INTEGER | NULL | Lama simpanan dalam bulan (withdrawal only) |
| `created_at` | TIMESTAMP | DEFAULT NOW() | Tanggal record dibuat |

**Indexes:**
- PRIMARY KEY on `id`
- FOREIGN KEY on `account_id` â†’ `accounts(id)` ON DELETE CASCADE
- INDEX on `account_id` (untuk query by account)
- INDEX on `transaction_date` (untuk sorting)

**Constraints:**
- `type` must be 'deposit' or 'withdrawal'
- `amount` must be > 0

**Sample Data:**
```sql
-- Deposit
INSERT INTO transactions 
(id, account_id, type, amount, transaction_date, balance_before, balance_after) 
VALUES 
('t1-uuid', '7a3e9140-...', 'deposit', 500000.00, '2025-12-01 10:00:00', 
 1000000.00, 1500000.00);

-- Withdrawal with interest
INSERT INTO transactions 
(id, account_id, type, amount, transaction_date, balance_before, balance_after, 
 interest_earned, months_held) 
VALUES 
('t2-uuid', '7a3e9140-...', 'withdrawal', 300000.00, '2025-12-03 10:00:00', 
 1500000.00, 1225000.00, 25000.00, 4);
```

---

## ğŸ” Database Constraints Summary

### Primary Keys
- All tables use UUID as primary key (prevents enumeration attacks)

### Foreign Keys
- `accounts.customer_id` â†’ `customers.id` (ON DELETE CASCADE)
- `accounts.deposito_type_id` â†’ `deposito_types.id` (ON DELETE RESTRICT)
- `transactions.account_id` â†’ `accounts.id` (ON DELETE CASCADE)

### Check Constraints
- `deposito_types.yearly_return` between 0 and 1
- `accounts.balance` >= 0
- `transactions.amount` > 0
- `transactions.type` in ('deposit', 'withdrawal')

### Unique Constraints
- None (customer bisa punya 1 account enforced via app logic, bukan DB constraint)

---

## ğŸ“ Business Rules (Implemented in Application)

1. **Customer Account Limit**  
   - 1 customer hanya bisa punya 1 account
   - Dicheck saat create account

2. **Interest Calculation (Withdrawal)**
   ```
   interest = balance Ã— yearly_return Ã— (months_held / 12)
   ```
   - `months_held` = selisih bulan antara `account.created_at` dan `transaction_date`
   - Simple interest, bukan compound

3. **Balance Updates**
   - Deposit: `new_balance = old_balance + amount`
   - Withdrawal: `new_balance = old_balance - amount + interest`

4. **Transaction Immutability**
   - Transactions tidak bisa diupdate/delete
   - Hanya INSERT allowed

---

## ğŸ—‚ï¸ Database File Location

**Schema SQL:**
```
d:\WORKS\MOBILE\BankSavingSystem-API\database\schema.sql
```

**Contains:**
- CREATE TABLE statements
- Indexes
- Foreign key constraints
- Sample data

---

## ğŸ“Š ER Diagram (Detailed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   customers     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)        â”‚
â”‚ name           â”‚
â”‚ created_at     â”‚
â”‚ updated_at     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   accounts          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)            â”‚
â”‚ customer_id (FK)   â”‚
â”‚ deposito_type_id(FK)â”‚
â”‚ balance            â”‚
â”‚ created_at         â”‚
â”‚ updated_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  transactions       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)            â”‚
â”‚ account_id (FK)    â”‚
â”‚ type               â”‚
â”‚ amount             â”‚
â”‚ transaction_date   â”‚
â”‚ balance_before     â”‚
â”‚ balance_after      â”‚
â”‚ interest_earned    â”‚
â”‚ months_held        â”‚
â”‚ created_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ deposito_types  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)        â”‚
â”‚ name           â”‚
â”‚ yearly_return  â”‚
â”‚ created_at     â”‚
â”‚ updated_at     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   accounts      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Database Design Checklist

- [x] 4 main tables designed
- [x] Primary keys (UUID)
- [x] Foreign keys with CASCADE/RESTRICT
- [x] Proper indexes
- [x] Check constraints
- [x] Timestamps (created_at, updated_at)
- [x] DECIMAL for money fields
- [x] VARCHAR for text fields
- [x] Business rules documented
- [x] Sample data provided

**Status:** âœ… **Database Design Complete**
