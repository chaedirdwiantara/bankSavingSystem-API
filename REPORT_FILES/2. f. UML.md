# System Architecture Diagram - Bank Saving System

## ğŸ—ï¸ High-Level Architecture

Bank Saving System menggunakan arsitektur **Client-Server** dengan **RESTful API** sebagai penghubung antara mobile app dan database.

---

## ğŸ“Š System Architecture Diagram

```mermaid
graph TB
    subgraph "Client Layer - Mobile App"
        A[React Native App]
        A1[UI Components]
        A2[Redux Store]
        A3[Redux Saga]
        A4[API Client - Axios]
        
        A --> A1
        A --> A2
        A2 --> A3
        A3 --> A4
    end
    
    subgraph "Network Layer"
        N1[HTTP/HTTPS]
        N2[JSON]
    end
    
    subgraph "Server Layer - Backend API"
        B[Express.js Server]
        B1[Routes]
        B2[Middleware]
        B3[Controllers]
        B4[Services]
        B5[Supabase Client]
        
        B --> B1
        B --> B2
        B1 --> B3
        B3 --> B4
        B4 --> B5
    end
    
    subgraph "Database Layer"
        C[(Supabase PostgreSQL)]
        C1[customers table]
        C2[deposito_types table]
        C3[accounts table]
        C4[transactions table]
        
        C --> C1
        C --> C2
        C --> C3
        C --> C4
    end
    
    subgraph "External Services"
        D1[Railway Hosting]
        D2[Swagger UI]
    end
    
    A4 -->|REST API Calls| N1
    N1 -->|Request/Response| B
    B5 -->|SQL Queries| C
    B --> D2
    D1 -->|Hosts| B
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#f0f0f0
    style D1 fill:#e8f5e9
    style D2 fill:#e8f5e9
```

---

## ğŸ”§ Technology Stack

### Frontend (Mobile)
- **Framework:** React Native
- **State Management:** Redux + Redux Saga
- **HTTP Client:** Axios
- **UI Components:** Custom components
- **Navigation:** React Navigation
- **Development Tools:** Reactotron

### Backend (API)
- **Runtime:** Node.js
- **Framework:** Express.js
- **Language:** TypeScript
- **Validation:** express-validator
- **Documentation:** Swagger (swagger-jsdoc + swagger-ui-express)
- **CORS:** cors middleware
- **Logging:** morgan

### Database
- **Platform:** Supabase
- **Database:** PostgreSQL
- **Client:** @supabase/supabase-js

### Hosting & Deployment
- **Backend Hosting:** Railway
- **Production URL:** https://banksavingsystem-api-production.up.railway.app

---

## ğŸ“± Client Layer Details

### React Native App Structure
```
src/
â”œâ”€â”€ components/         # Reusable UI components
â”‚   â””â”€â”€ common/        # Input, Button, etc.
â”œâ”€â”€ screens/           # Screen components
â”‚   â”œâ”€â”€ Customer/
â”‚   â”œâ”€â”€ DepositoType/
â”‚   â”œâ”€â”€ Account/
â”‚   â””â”€â”€ Transaction/
â”œâ”€â”€ store/             # Redux store
â”‚   â”œâ”€â”€ slices/        # Redux slices
â”‚   â””â”€â”€ sagas/         # Redux sagas
â”œâ”€â”€ services/          # API services
â”‚   â”œâ”€â”€ api.ts         # Axios config
â”‚   â”œâ”€â”€ customerService.ts
â”‚   â”œâ”€â”€ depositoTypeService.ts
â”‚   â”œâ”€â”€ accountService.ts
â”‚   â””â”€â”€ transactionService.ts
â””â”€â”€ navigation/        # Navigation config
```

### State Management Flow
```
UI Component â†’ Dispatch Action â†’ Redux Saga â†’ API Call â†’ Response â†’ Update Store â†’ Re-render UI
```

---

## ğŸ–¥ï¸ Server Layer Details

### Express.js API Structure
```
src/
â”œâ”€â”€ config/            # Configuration
â”‚   â”œâ”€â”€ supabase.ts   # Supabase client
â”‚   â””â”€â”€ swagger.ts    # Swagger config
â”œâ”€â”€ types/             # TypeScript types
â”œâ”€â”€ middleware/        # Express middleware
â”‚   â”œâ”€â”€ errorHandler.ts
â”‚   â””â”€â”€ validator.ts
â”œâ”€â”€ controllers/       # Request handlers
â”œâ”€â”€ services/          # Business logic
â”œâ”€â”€ routes/            # Route definitions
â””â”€â”€ server.ts          # Express app
```

### Request Flow
```
HTTP Request â†’ Routes â†’ Validation Middleware â†’ Controller â†’ Service â†’ Supabase Client â†’ Database
                                                                                              â†“
HTTP Response â† JSON Formatter â† Controller â† Service Result â† Query Result â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Database Layer Details

### Supabase PostgreSQL Schema

```mermaid
erDiagram
    customers ||--o{ accounts : has
    deposito_types ||--o{ accounts : defines
    accounts ||--o{ transactions : has
    
    customers {
        uuid id PK
        varchar name
        timestamp created_at
        timestamp updated_at
    }
    
    deposito_types {
        uuid id PK
        varchar name
        decimal yearly_return
        timestamp created_at
        timestamp updated_at
    }
    
    accounts {
        uuid id PK
        uuid customer_id FK
        uuid deposito_type_id FK
        decimal balance
        timestamp created_at
        timestamp updated_at
    }
    
    transactions {
        uuid id PK
        uuid account_id FK
        varchar type
        decimal amount
        timestamp transaction_date
        decimal balance_before
        decimal balance_after
        decimal interest_earned
        integer months_held
        timestamp created_at
    }
```

---

## ğŸ”„ Data Flow

### Create Customer Flow
```
Mobile App â†’ POST /api/customers â†’ ValidationMiddleware â†’ CustomerController 
â†’ CustomerService.create() â†’ Supabase INSERT â†’ Return Customer Object 
â†’ Response to App â†’ Update Redux Store â†’ Re-render UI
```

### Process Withdrawal with Interest Flow
```
Mobile App â†’ POST /api/transactions/withdrawal â†’ ValidationMiddleware 
â†’ TransactionController â†’ TransactionService.processWithdrawal()
  â”œâ”€ Get Account Details (with deposito_type)
  â”œâ”€ Calculate Interest (yearly_return Ã— months_held / 12)
  â”œâ”€ Validate Sufficient Balance
  â”œâ”€ Update Account Balance
  â””â”€ Record Transaction (with interest details)
â†’ Response to App â†’ Update Redux Store â†’ Re-render UI
```

---

## ğŸŒ Communication Protocols

### API Communication
- **Protocol:** HTTP/HTTPS
- **Format:** JSON
- **Methods:** GET, POST, PUT, DELETE
- **Authentication:** Not implemented (per requirements)
- **Base URL (Dev):** `http://10.0.2.2:3000/api`
- **Base URL (Prod):** `https://banksavingsystem-api-production.up.railway.app/api`

### Request/Response Format
```json
// Success Response
{
  "success": true,
  "data": { ... }
}

// Error Response
{
  "success": false,
  "error": "Error message"
}
```

---

## ğŸ”’ Security Layers

### Input Validation
- express-validator on all endpoints
- Type checking (TypeScript)
- Required field validation
- Data format validation

### Error Handling
- Global error handler middleware
- Custom AppError class
- Proper HTTP status codes
- User-friendly error messages

### Database Security
- Supabase Row Level Security (RLS) - Optional
- Parameterized queries (SQL injection prevention)
- UUID primary keys (prevent enumeration)

---

## ğŸ“Š Scalability Considerations

### Current Architecture
- Stateless API (horizontal scaling ready)
- Database via Supabase (managed scaling)
- Mobile client (distributed load)

### Future Enhancements
- Load balancer (if needed)
- Caching layer (Redis)
- CDN for static assets
- Database read replicas
- Authentication & authorization (JWT)

---

## ğŸ› ï¸ Development vs Production

### Development Environment
- Backend: `localhost:3000`
- Database: Supabase (shared instance)
- Debugging: Reactotron enabled
- Hot reload: Enabled

### Production Environment
- Backend: Railway hosting
- Database: Supabase (production instance)
- Debugging: Disabled
- Optimized builds
- HTTPS enforced

---

## âœ… Architecture Benefits

1. **Separation of Concerns** - Clear layer separation
2. **Scalability** - Stateless API, managed database
3. **Maintainability** - Modular structure
4. **Type Safety** - TypeScript throughout
5. **Documentation** - Swagger for API docs
6. **Error Handling** - Centralized error management
7. **Validation** - Input validation at all levels
8. **Testing Ready** - Testable service layer

---

## ğŸ¯ System Characteristics

- **Architecture Style:** Client-Server, RESTful
- **Communication:** Synchronous HTTP
- **State Management:** Redux (Frontend)
- **Business Logic:** Service Layer (Backend)
- **Data Persistence:** PostgreSQL (Supabase)
- **Deployment:** Cloud-hosted (Railway + Supabase)
