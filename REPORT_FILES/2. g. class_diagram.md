# Class Diagram - Bank Saving System

## ğŸ¯ System Architecture

Bank Saving System menggunakan arsitektur MVC (Model-View-Controller) dengan layer separation:
- **Entity Layer** - Data models
- **Service Layer** - Business logic
- **Controller Layer** - HTTP request handlers
- **Frontend** - React Native UI components

---

## ğŸ“Š Class Diagram

```mermaid
classDiagram
    %% Entity Classes
    class Customer {
        +UUID id
        +String name
        +DateTime created_at
        +DateTime updated_at
    }

    class DepositoType {
        +UUID id
        +String name
        +Decimal yearly_return
        +DateTime created_at
        +DateTime updated_at
    }

    class Account {
        +UUID id
        +UUID customer_id
        +UUID deposito_type_id
        +Decimal balance
        +DateTime created_at
        +DateTime updated_at
        +getCustomer() Customer
        +getDepositoType() DepositoType
    }

    class Transaction {
        +UUID id
        +UUID account_id
        +String type
        +Decimal amount
        +DateTime transaction_date
        +Decimal balance_before
        +Decimal balance_after
        +Decimal interest_earned
        +Integer months_held
        +DateTime created_at
    }

    %% Service Classes
    class CustomerService {
        -SupabaseClient supabase
        +getAll() Customer[]
        +getById(id) Customer
        +create(data) Customer
        +update(id, data) Customer
        +delete(id) void
        +search(name) Customer[]
    }

    class DepositoTypeService {
        -SupabaseClient supabase
        +getAll() DepositoType[]
        +getById(id) DepositoType
        +create(data) DepositoType
        +update(id, data) DepositoType
        +delete(id) void
    }

    class AccountService {
        -SupabaseClient supabase
        +getAll(customerId?) Account[]
        +getById(id) Account
        +create(data) Account
        +updateBalance(id, amount) void
        +delete(id) void
    }

    class TransactionService {
        -SupabaseClient supabase
        -AccountService accountService
        +getAllTransactions(accountId?) Transaction[]
        +processDeposit(data) Transaction
        +processWithdrawal(data) Transaction
        -calculateInterest(account, date) Decimal
    }

    %% Controller Classes
    class CustomerController {
        -CustomerService service
        +getAllCustomers(req, res) void
        +getCustomerById(req, res) void
        +createCustomer(req, res) void
        +updateCustomer(req, res) void
        +deleteCustomer(req, res) void
    }

    class DepositoTypeController {
        -DepositoTypeService service
        +getAllDepositoTypes(req, res) void
        +getDepositoTypeById(req, res) void
        +createDepositoType(req, res) void
        +updateDepositoType(req, res) void
        +deleteDepositoType(req, res) void
    }

    class AccountController {
        -AccountService service
        +getAllAccounts(req, res) void
        +getAccountById(req, res) void
        +createAccount(req, res) void
        +deleteAccount(req, res) void
    }

    class TransactionController {
        -TransactionService service
        +getAllTransactions(req, res) void
        +processDeposit(req, res) void
        +processWithdrawal(req, res) void
    }

    %% Middleware Classes
    class ErrorHandler {
        +handleError(err, req, res, next) void
    }

    class Validator {
        +validateRequest(req, res, next) void
    }

    %% Relationships - Entity Layer
    Account "1" --> "1" Customer : belongs to
    Account "1" --> "1" DepositoType : has type
    Transaction "1" --> "1" Account : belongs to

    %% Relationships - Service Layer
    CustomerService ..> Customer : manages
    DepositoTypeService ..> DepositoType : manages
    AccountService ..> Account : manages
    AccountService ..> Customer : validates
    AccountService ..> DepositoType : validates
    TransactionService ..> Transaction : manages
    TransactionService ..> Account : updates
    TransactionService --> AccountService : uses

    %% Relationships - Controller Layer
    CustomerController --> CustomerService : uses
    DepositoTypeController --> DepositoTypeService : uses
    AccountController --> AccountService : uses
    TransactionController --> TransactionService : uses
```

---

## ğŸ—ï¸ Layer Descriptions

### 1. Entity Layer (Data Models)

#### Customer
**Attributes:**
- `id` (UUID) - Unique identifier
- `name` (String) - Customer full name
- `created_at` (DateTime) - Creation timestamp
- `updated_at` (DateTime) - Last update timestamp

**Relationships:**
- Has many `Account`

---

#### DepositoType
**Attributes:**
- `id` (UUID) - Unique identifier
- `name` (String) - Deposito type name (e.g., "Gold Deposito")
- `yearly_return` (Decimal) - Annual interest rate (0-1, e.g., 0.05 = 5%)
- `created_at` (DateTime) - Creation timestamp
- `updated_at` (DateTime) - Last update timestamp

**Relationships:**
- Has many `Account`

---

#### Account
**Attributes:**
- `id` (UUID) - Unique identifier
- `customer_id` (UUID) - Foreign key to Customer
- `deposito_type_id` (UUID) - Foreign key to DepositoType
- `balance` (Decimal) - Current account balance
- `created_at` (DateTime) - Account creation date (used for interest calculation)
- `updated_at` (DateTime) - Last update timestamp

**Methods:**
- `getCustomer()` - Returns associated Customer
- `getDepositoType()` - Returns associated DepositoType

**Relationships:**
- Belongs to one `Customer`
- Belongs to one `DepositoType`
- Has many `Transaction`

---

#### Transaction
**Attributes:**
- `id` (UUID) - Unique identifier
- `account_id` (UUID) - Foreign key to Account
- `type` (String) - Transaction type: "deposit" or "withdrawal"
- `amount` (Decimal) - Transaction amount
- `transaction_date` (DateTime) - When transaction occurred
- `balance_before` (Decimal) - Balance before transaction
- `balance_after` (Decimal) - Balance after transaction
- `interest_earned` (Decimal, nullable) - Interest calculated (withdrawal only)
- `months_held` (Integer, nullable) - Months account was held (withdrawal only)
- `created_at` (DateTime) - Record creation timestamp

**Relationships:**
- Belongs to one `Account`

---

### 2. Service Layer (Business Logic)

#### CustomerService
**Dependencies:** Supabase Client

**Methods:**
- `getAll()` - Retrieve all customers
- `getById(id)` - Get single customer
- `create(data)` - Create new customer
- `update(id, data)` - Update customer
- `delete(id)` - Delete customer
- `search(name)` - Search by name

**Responsibilities:**
- Customer CRUD operations
- Data validation
- Search functionality

---

#### DepositoTypeService
**Dependencies:** Supabase Client

**Methods:**
- `getAll()` - Retrieve all deposito types
- `getById(id)` - Get single deposito type
- `create(data)` - Create new type
- `update(id, data)` - Update type
- `delete(id)` - Delete type

**Responsibilities:**
- Deposito type CRUD operations
- Yearly return rate management

---

#### AccountService
**Dependencies:** Supabase Client

**Methods:**
- `getAll(customerId?)` - Get all accounts, optionally filtered
- `getById(id)` - Get account with customer and deposito type details
- `create(data)` - Create account with initial balance
- `updateBalance(id, amount)` - Update account balance
- `delete(id)` - Delete account

**Responsibilities:**
- Account CRUD operations
- Balance management
- Customer and deposito type validation

---

#### TransactionService
**Dependencies:** Supabase Client, AccountService

**Methods:**
- `getAllTransactions(accountId?)` - Get all transactions
- `processDeposit(data)` - Add funds to account
- `processWithdrawal(data)` - Withdraw funds with interest
- `calculateInterest(account, date)` - Calculate interest earned

**Responsibilities:**
- Transaction processing
- Interest calculation
- Balance updates
- Transaction history

**Interest Calculation Formula:**
```
interest = balance Ã— yearly_return Ã— (months_held / 12)
```

---

### 3. Controller Layer (HTTP Handlers)

#### CustomerController
**Dependencies:** CustomerService

**Endpoints:**
- `GET /api/customers` - List all
- `GET /api/customers/:id` - Get one
- `POST /api/customers` - Create
- `PUT /api/customers/:id` - Update
- `DELETE /api/customers/:id` - Delete

---

#### DepositoTypeController
**Dependencies:** DepositoTypeService

**Endpoints:**
- `GET /api/deposito-types` - List all
- `GET /api/deposito-types/:id` - Get one
- `POST /api/deposito-types` - Create
- `PUT /api/deposito-types/:id` - Update
- `DELETE /api/deposito-types/:id` - Delete

---

#### AccountController
**Dependencies:** AccountService

**Endpoints:**
- `GET /api/accounts` - List all
- `GET /api/accounts/:id` - Get one
- `POST /api/accounts` - Create
- `DELETE /api/accounts/:id` - Delete

---

#### TransactionController
**Dependencies:** TransactionService

**Endpoints:**
- `GET /api/transactions` - List all
- `POST /api/transactions/deposit` - Process deposit
- `POST /api/transactions/withdrawal` - Process withdrawal

---

### 4. Middleware

#### ErrorHandler
**Purpose:** Global error handling

**Method:**
- `handleError(err, req, res, next)` - Catch and format errors

---

#### Validator
**Purpose:** Request validation

**Method:**
- `validateRequest(req, res, next)` - Validate input using express-validator

---

## ğŸ”— Relationships Summary

### Entity Relationships
- `Customer` â† (1:N) â†’ `Account`
- `DepositoType` â† (1:N) â†’ `Account`
- `Account` â† (1:N) â†’ `Transaction`

### Dependency Relationships
- `Controller` â†’ `Service` (uses)
- `Service` â†’ `Entity` (manages)
- `TransactionService` â†’ `AccountService` (uses)

---

## ğŸ“¦ Package Structure

```
src/
â”œâ”€â”€ types/              # Entity type definitions
â”‚   â”œâ”€â”€ customer.types.ts
â”‚   â”œâ”€â”€ deposito.types.ts
â”‚   â”œâ”€â”€ account.types.ts
â”‚   â””â”€â”€ transaction.types.ts
â”œâ”€â”€ services/           # Business logic layer
â”‚   â”œâ”€â”€ customer.service.ts
â”‚   â”œâ”€â”€ deposito.service.ts
â”‚   â”œâ”€â”€ account.service.ts
â”‚   â””â”€â”€ transaction.service.ts
â”œâ”€â”€ controllers/        # HTTP handlers
â”‚   â”œâ”€â”€ customer.controller.ts
â”‚   â”œâ”€â”€ deposito.controller.ts
â”‚   â”œâ”€â”€ account.controller.ts
â”‚   â””â”€â”€ transaction.controller.ts
â”œâ”€â”€ middleware/         # Request middleware
â”‚   â”œâ”€â”€ errorHandler.ts
â”‚   â””â”€â”€ validator.ts
â””â”€â”€ routes/            # Route definitions
    â”œâ”€â”€ customer.routes.ts
    â”œâ”€â”€ deposito.routes.ts
    â”œâ”€â”€ account.routes.ts
    â””â”€â”€ transaction.routes.ts
```

---

## âœ… Design Patterns Used

1. **MVC Pattern** - Separation of concerns (Model-View-Controller)
2. **Service Layer Pattern** - Business logic encapsulation
3. **Repository Pattern** - Data access abstraction (via Supabase)
4. **Dependency Injection** - Services injected into controllers
5. **Singleton Pattern** - Supabase client instance

---

## ğŸ¯ Key Features

- âœ… Clear separation of concerns
- âœ… Reusable service layer
- âœ… Type-safe TypeScript interfaces
- âœ… Centralized error handling
- âœ… Input validation middleware
- âœ… Business logic in services (not controllers)
- âœ… Database access abstraction
